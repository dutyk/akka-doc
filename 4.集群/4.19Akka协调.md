Akka协调是一组用于分布式协调的工具。

# 模块信息
```xml```

# 租约
租约是用于分布式锁的可插入API。

# 使用租约
租约加载：

- 租约名称
- 配置位置以指示应加载的实现
- 所有者名称

任何租约实施都应提供以下保证：

- 具有相同名称的租约即使在不同的节点上多次加载，也是相同的租约
- 一次只有一位所有者可以获取租约

获得租约：
```java

```

获取租约会返回CompletionStage，因为通常通过第三方系统(例如Kubernetes API服务器或Zookeeper)来实现租约实现。

一旦获得租约，便可以调用checkLease以确保仍获得租约。由于租约实施是基于其他分布式系统的，因此租约可能会由于第三方系统超时而丢失。此操作不是异步的，因此可以在执行任何重要的操作之前调用它。

租约有一个所有者。如果同一所有者尝试多次获取租约，它将成功，即租约是可重入的。

选择对于您的用例而言唯一的租约名称很重要。如果租约对于集群中的每个节点都需要唯一，则可以使用集群主机端口：

```java

```
对于在同一节点上有多个不同租约的用例，则必须在名称中添加一些唯一的内容。例如，可以将租约与集群分片一起使用，在这种情况下，每个分片的租约名称中都包含分片ID。

## 设置租约心跳
如果具有租约的节点崩溃或无响应，则心跳超时是其他节点可以获取租约的时间。如果没有此超时，则在节点崩溃的情况下，需要操作员干预以释放租约。这是最安全的选择，但并非在所有情况下都可行。

该值应大于预期的最大JVM暂停，例如垃圾收集，否则其他节点可以获取租约，然后当原始节点再次响应时，原始租约所有者只有很短的时间采取行动，例如关闭分片或单例。

# 其他Akka模块中的用法
租约可用于集群单例和集群分片。

# 租约实施
Kubernetes API
# 实施租约
实现应扩展akka.coordination.lease.javadsl.Lease
```java

```
该方法应提供以下保证：

- acquire应以以下内容完成：如果已获取租约，则为true；如果租约是由另一个所有者承揽的，则为false；如果无法与实现租约的第三方系统通信，则为失败。
- release 应以以下内容完成：如果已明确释放了租约，则为true；如果绝对没有释放租约，则为false；如果未知，则为失败；如果已释放租约，则失败。
- checkLease应该返回false直到acquire CompletionStage完成；如果由于与第三方通信错误而导致租约丢失，则应该返回false。Check 租约也不应阻止。
- 仅在aquire CompletionStage完成后才调用获取租约丢失回调，如果租约丢失，则应调用该命令，例如失去与第三方系统的通信。

另外，预计租约实施将包含生存时间机制，这意味着万一节点崩溃，租约将永远不会保留。如果用户在这种情况下为了最大的安全性而希望外部干预，则可以将生存时间设置为无限。

配置必须为租约实现的FQCN定义lease-class属性。

租约实现应支持以下属性，其中默认值来自akka.coordination.lease：
```conf
```

该配置位置被传递到getLease中。
```conf
```
